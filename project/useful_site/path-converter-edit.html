<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>í´ë” íŠ¸ë¦¬ ê¸°ë°˜ ê²½ë¡œ ë³€í™˜ê¸°</title>
    <link
      href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fira Code", monospace;
        background: #1e1e1e;
        color: #d4d4d4;
        margin: 0;
        padding: 2rem;
      }
      .container {
        max-width: 1400px;
        margin: auto;
        display: flex;
        gap: 2rem;
      }
      .left,
      .right {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .tree {
        background: #1e1e1e;
        padding: 1rem;
        border: 1px solid #555;
        border-radius: 0.5rem;
        max-height: 400px;
        overflow-y: auto;
      }
      ul {
        list-style: none;
        padding-left: 1rem;
      }
      li {
        margin: 0.25rem 0;
        padding: 5px;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
      }
      li.drag-over {
        background: #444;
      }
      .start {
        color: #4fc3f7;
        font-weight: bold;
      }
      .target {
        color: #81c784;
        font-weight: bold;
      }
      .context-menu {
        position: absolute;
        z-index: 1000;
        background: #333;
        border: 1px solid #666;
        padding: 0.5rem;
        border-radius: 5px;
        display: none;
      }
      .context-menu button {
        background: none;
        border: none;
        color: #fff;
        text-align: left;
        padding: 0.3rem;
        width: 100%;
        cursor: pointer;
      }
      .context-menu button:hover {
        background: #555;
      }
      .modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #2d2d2d;
        padding: 2rem;
        border: 1px solid #555;
        border-radius: 1rem;
        z-index: 2000;
      }
      .modal input {
        width: 100%;
        padding: 0.5rem;
        background: #1e1e1e;
        color: #fff;
        border: 1px solid #666;
        margin-bottom: 1rem;
      }
      .modal button {
        width: 48%;
        padding: 0.5rem;
        margin: 0.25rem;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .modal .confirm {
        background: #0e639c;
        color: white;
      }
      .modal .cancel {
        background: #666;
        color: white;
      }
      textarea {
        background: #1e1e1e;
        color: #d4d4d4;
        border: 1px solid #555;
        border-radius: 0.5rem;
        padding: 1rem;
        height: 200px;
        resize: none;
        overflow-y: auto;
        font-family: "Fira Code", monospace;
      }
      textarea::-webkit-scrollbar {
        display: none;
      }
      pre {
        background: #1e1e1e;
        border: 1px solid #555;
        border-radius: 0.5rem;
        padding: 1rem;
        height: 300px;
        overflow-y: auto;
      }
      pre::-webkit-scrollbar {
        display: none;
      }
      .options {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="left">
        <h2>ğŸ“ í´ë” íŠ¸ë¦¬ ê´€ë¦¬</h2>
        <div
          class="tree"
          id="tree"
          oncontextmenu="showContextMenu(event, null)"
        >
          <ul id="tree-root">
            <li
              draggable="true"
              data-role="start"
              ondragstart="dragStart(event)"
              ondrop="drop(event)"
              ondragover="allowDrop(event)"
              oncontextmenu="showContextMenu(event, this)"
            >
              ğŸ“„ start.html
            </li>
            <li
              draggable="true"
              data-role="target"
              ondragstart="dragStart(event)"
              ondrop="drop(event)"
              ondragover="allowDrop(event)"
              oncontextmenu="showContextMenu(event, this)"
            >
              ğŸ“„ target.html
            </li>
          </ul>
        </div>

        <div class="options">
          <label
            ><input
              type="radio"
              name="mode"
              value="relative"
              checked
              onchange="updatePath()"
            />
            ì ˆëŒ€ â†’ ìƒëŒ€</label
          >
          <label
            ><input
              type="radio"
              name="mode"
              value="absolute"
              onchange="updatePath()"
            />
            ìƒëŒ€ â†’ ì ˆëŒ€</label
          >
        </div>

        <textarea
          id="input"
          placeholder="ì—¬ê¸°ì— HTML ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"
          oninput="updatePath()"
        ></textarea>
      </div>

      <div class="right">
        <h2>ğŸ“ ë³€í™˜ëœ ì½”ë“œ</h2>
        <pre><code id="result" class="language-html"></code></pre>
      </div>
    </div>

    <div class="context-menu" id="context-menu">
      <button onclick="createFolder()">â• í´ë” ì¶”ê°€</button>
      <button onclick="renameItem()">âœï¸ ì´ë¦„ ìˆ˜ì •</button>
      <button onclick="deleteItem()">ğŸ—‘ï¸ ì‚­ì œ</button>
    </div>

    <div class="modal" id="modal">
      <input type="text" id="modal-input" placeholder="í´ë” ì´ë¦„ ì…ë ¥" />
      <div style="text-align: center">
        <button class="confirm" onclick="confirmModal()">í™•ì¸</button>
        <button class="cancel" onclick="cancelModal()">ì·¨ì†Œ</button>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markup.min.js"></script>

    <script>
      let draggedItem = null;
      let selectedItem = null;
      let modalMode = "";
      let mode = "relative"; // ê¸°ë³¸ ë³€í™˜ ëª¨ë“œ: ì ˆëŒ€ â†’ ìƒëŒ€

      // ë“œë˜ê·¸ ì‹œì‘
      function dragStart(event) {
        draggedItem = event.target;
      }

      // ë“œë˜ê·¸ í—ˆìš©
      function allowDrop(event) {
        event.preventDefault();
        event.target.classList.add("drag-over");
      }

      // ë“œë¡­
      function drop(event) {
        event.preventDefault();
        event.target.classList.remove("drag-over");
        if (
          draggedItem &&
          event.target.tagName === "LI" &&
          draggedItem !== event.target
        ) {
          let targetUl = event.target.querySelector("ul");
          if (!targetUl) {
            targetUl = document.createElement("ul");
            event.target.appendChild(targetUl);
          }
          targetUl.appendChild(draggedItem);
          updatePath();
        }
      }

      // ìš°í´ë¦­ ë©”ë‰´
      function showContextMenu(event, item) {
        event.preventDefault();
        selectedItem = item;

        const menu = document.getElementById("context-menu");
        menu.style.top = `${event.pageY}px`;
        menu.style.left = `${event.pageX}px`;
        menu.style.display = "block";
      }

      // í´ë¦­ ì‹œ ë©”ë‰´ ìˆ¨ê¹€
      window.addEventListener("click", () => {
        document.getElementById("context-menu").style.display = "none";
      });

      // ëª¨ë‹¬ ì—´ê¸°
      function openModal(modeType) {
        modalMode = modeType;
        document.getElementById("modal").style.display = "block";
        document.getElementById("modal-input").value = "";
        document.getElementById("modal-input").focus();
      }

      // ëª¨ë‹¬ ë‹«ê¸°
      function cancelModal() {
        document.getElementById("modal").style.display = "none";
      }

      // í´ë” ì¶”ê°€
      function createFolder() {
        openModal("create");
      }

      // ì´ë¦„ ìˆ˜ì •
      function renameItem() {
        if (!selectedItem || isProtected(selectedItem)) return;
        openModal("rename");
      }

      // ì‚­ì œ
      function deleteItem() {
        if (!selectedItem || isProtected(selectedItem)) return;
        selectedItem.parentElement.removeChild(selectedItem);
      }

      // ë³´í˜¸ëœ íŒŒì¼ì¸ì§€ í™•ì¸
      function isProtected(item) {
        return item.dataset.role === "start" || item.dataset.role === "target";
      }

      // ëª¨ë‹¬ ì…ë ¥ í™•ì¸
      function confirmModal() {
        const input = document.getElementById("modal-input").value.trim();
        if (input === "") return;

        if (modalMode === "create") {
          const li = document.createElement("li");
          li.innerHTML = `ğŸ“ ${input}`;
          li.draggable = true;
          li.ondragstart = dragStart;
          li.ondrop = drop;
          li.ondragover = allowDrop;
          li.oncontextmenu = (e) => showContextMenu(e, li);

          if (selectedItem) {
            let ul = selectedItem.querySelector("ul");
            if (!ul) {
              ul = document.createElement("ul");
              selectedItem.appendChild(ul);
            }
            ul.appendChild(li);
          } else {
            document.getElementById("tree-root").appendChild(li);
          }
        } else if (modalMode === "rename") {
          const isStart = selectedItem.dataset.role === "start";
          const isTarget = selectedItem.dataset.role === "target";
          if (isStart || isTarget) {
            selectedItem.innerHTML = `ğŸ“„ ${input}`;
          } else {
            selectedItem.innerHTML = `ğŸ“ ${input}`;
          }
        }

        cancelModal();
        updatePath();
      }

      // ë³€í™˜ ëª¨ë“œ ë³€ê²½
      function updateMode() {
        mode = document.querySelector('input[name="mode"]:checked').value;
        updatePath();
      }

      // ì‹œì‘/ë³€í™˜ íŒŒì¼ ê²½ë¡œ ì¶”ì¶œ
      function getPath(item) {
        let path = "";
        while (item && item.tagName === "LI") {
          const text = item.textContent.trim().replace(/^ğŸ“\s|^ğŸ“„\s/, "");
          path = "/" + text + path;
          item = item.parentElement.closest("li");
        }
        return path;
      }

      // ìƒëŒ€ ê²½ë¡œ ê³„ì‚°
      function calculateRelativePath(fromPath, toPath) {
        const from = fromPath.split("/").filter(Boolean);
        const to = toPath.split("/").filter(Boolean);

        while (from.length && to.length && from[0] === to[0]) {
          from.shift();
          to.shift();
        }

        return "../".repeat(from.length) + to.join("/");
      }

      // ë³€í™˜ ë¡œì§
      function updatePath() {
        const startFile = document.querySelector('[data-role="start"]');
        const targetFile = document.querySelector('[data-role="target"]');

        if (!startFile || !targetFile) return;

        const fromPath = getPath(startFile);
        const toPath = getPath(targetFile);

        let transformedPath = "";

        if (mode === "relative") {
          transformedPath = calculateRelativePath(fromPath, toPath);
        } else {
          transformedPath = toPath;
        }

        // ë¶™ì—¬ë„£ì€ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        const inputCode = document.getElementById("input").value;

        // src, href ì†ì„± ë³€í™˜
        let output = inputCode
          .replace(/src="([^"]*)"/g, `src="${transformedPath}"`)
          .replace(/href="([^"]*)"/g, `href="${transformedPath}"`);

        document.getElementById("result").textContent = output;
        Prism.highlightElement(document.getElementById("result"));
      }

      // ë¼ë””ì˜¤ ë²„íŠ¼ ë³€ê²½ ê°ì§€
      document.querySelectorAll('input[name="mode"]').forEach((radio) => {
        radio.addEventListener("change", updateMode);
      });
    </script>
  </body>
</html>
